## M2简要报告

### _init_main
这个函数用来初始化main协程有关信息，只执行一次。但是为了确保执行，在
co_start和co_yield开始都调用了这个函数。

此外函数里还初始化了随机数种子，这是用来之后调度的时候随机选一个协程。

### co_start
我维护了一个_co_last，用来指示_pool里最后一个协程的下标，但其实不维护也
没有影响。

这个函数唯一要注意的是关于stack的初始化，这里做到了16位对齐。

### co_yield
第一次从setjmp返回调用_pick_co，第二次从setjmp返回就直接返回了。

主要是_pick_co；这个函数先调用_find找一个可以运行的协程。
* 如果这个协程是之前运行，但调用了co_yield退出，就直接longjmp。
* 如果是刚创建的协程，就要初始化栈指针rsp，把参数设置好，然后jmp到函数入口。
  **非常重要**：注意一开始设置栈的时候我们要压入协程执行函数的返回地址。这里
  我们注意到协程返回后要重新调度，但是还要把这个协程status设置成DEAD，所以
  这里压入的地址是_pick_co_finish。

### co_wait
这个函数要调用co_yield。调用co_yield之前把自己的状态设置好。调用co_yield之后要
替自己等待的函数收尸。

**一点思考**：实验报告里是推荐在co_wait给等待的协程释放资源，所以每个协程必须且
只能被co_wait一次。但是我觉得这个完全可以在协程退出时释放资源，也就是放在
_pick_co_finish里面。这样一个协程被co_wait 0次和几次都可以。


